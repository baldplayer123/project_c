#define _GNU_SOURCE
#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <dlfcn.h>
#include <stdlib.h>

// This is baaaaad
// extern char *program_invocation_name;
// extern char *program_invocation_short_name;

int checkifssh(){
	FILE *file = fopen("/proc/self/comm", "r");
  char string[100];
	fgets(string, sizeof(string), file);
  string[strcspn(string, "\n")] = 0;
  fclose(file);
	if (strncmp(string, "ssh", 3) == 0) {
	  // printf("Compare workedi\n");
    return 1;
	}
 	return 0; 
}

ssize_t read(int fd, void *buf, size_t nbytes) {
  int is_ssh =  checkifssh();
  ssize_t (*r_read)(int fd, void *buf, size_t nbytes) = dlsym(RTLD_NEXT, "read");
  ssize_t output = r_read(fd, buf, nbytes);
  if (is_ssh == 1 && fd == 0) {
    printf("GOOD PLACE\n");
		// write(2, "GOOD PLACE\n", 11);
  }
  else {
    printf("Failed\n");
  }


  return output;
  }
