FROM debian

COPY ./malware /malware/

RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y \
        apt-utils \
        locales \
        gcc \
        nano \
        vim \
        ssh \
        net-tools \
        curl \
        sudo \
    && localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8 \
    && rm -rf /var/lib/apt/lists/*

RUN useradd -m -s /bin/bash -G sudo maluser && \
    echo "maluser:1234" | chpasswd && \
    echo "root:1234" | chpasswd && \
    echo "maluser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/maluser && \
    chmod 0440 /etc/sudoers.d/maluser

COPY ./loader/loader /home/maluser/malware/loader

RUN chown -R maluser:maluser /home/maluser/malware && \
    chmod -R +x /home/maluser/malware

USER maluser
WORKDIR /home/maluser/malware
